{% extends '_base.html'%}

{% block content %}

  <h5 class="card-header text-center"><b><i>{{ today }}</i></b></h5>
    <div class="select-holder">
    <select
      class="form-control frontpage-select"
      id="venue-select">
      {% for venue in venues %}
        <option value="{{ venue.code}}">{{ venue.name }}</option>
      {% endfor %}
    </select>
    <select
      class="form-control frontpage-select"
      id="chart-select">
    </select>
    </div>
    <div style="height: 65vh; overflow-y:scroll;">
    <table
      id="bets_table"
      class="table table-sm table-borderless" >
      <tbody id="bets" style="max-height: 100%"></tbody>
    </table>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel" style="color: black">Place Wager</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <!-- <div ></div> -->


  <script id="json-chart-data" type="application/json">
    {
      "bets_url": "{% url 'load_bets' %}",
      "charts_url": "{% url 'load_charts' %}"
    }
  </script>
<script>
  venue_select = document.getElementById("venue-select")
  chart_select = document.getElementById("chart-select")

  text_content = document.getElementById("json-chart-data").textContent
  chart_json_data = JSON.parse(text_content)



  load_charts = () => {
    venue_code = venue_select.value
    $.ajax({
      url: chart_json_data["charts_url"],
      dataType: "html",
      data: {
        "venue_code": venue_code,
      },
      success: function(data) {
        $("#chart-select").html(data)
        load_bets()
      }
    })
  }
  load_bets = () => {
      const chart_id = chart_select.value
      $.ajax({
        url: chart_json_data["bets_url"],
        dataType: "html",
        data: {
          "chart_id": chart_id,
        },
        success: function(data) {
          $("#bets").html(data)
        }
      })
    }
  window.onload = (event) => {
    load_charts(venue_select.value)

  };
  venue_select.addEventListener("change", load_charts)
  chart_select.addEventListener("change", load_bets)

</script>
{% endblock content %}
