{% extends "_base.html" %}

{% load static %}


{% block content %}
<div class="card">
<div class="card-header card-header-standout text-center"
style="font-size: 1.6em; margin:auto; font-style: italic; font-weight: bold">
Analysis
</div>
<div class="card-body">
  <div style="display: flex; flex-flow: row nowrap; justify-content: space-between; align-items: middle">
  <div class="btn-group" role="group">
     <button id="btnGroupDrop1" type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" style="margin-bottom: 8px; " data-bs-toggle="dropdown" aria-expanded="false">
       All Venues
     </button>
     <ul class="dropdown-menu" style="background-color: #212121;" aria-labelledby="btnGroupDrop1">
       <li><a class="dropdown-item venue-select" href="#" data-value="SL">Southland</a></li>
       <li><a class="dropdown-item venue-select" href="#" data-value="TS">Tri-State</a></li>
       <li><a class="dropdown-item venue-select" href="#" data-value="WD">Wheeling Downs</a></li>
     </ul>
   </div>

  <div class="btn-group" role="group" style="text-align:right" aria-label="Basic radio toggle button group">
    <input type="radio" class="btn-check" name="btnradio" value="{{ yesterday_date }}" id="btnradio1" autocomplete="off" checked>
    <label class="btn btn-outline-primary btn-sm" for="btnradio1">{{ yesterday }}</label>
    <input type="radio" class="btn-check " name="btnradio" value="" id="btnradio1" autocomplete="off" disabled>
    <label class="btn btn-outline-primary btn-sm" for="btnradio1">Week</label>
    <input type="radio" class="btn-check " name="btnradio" value="" id="btnradio1" autocomplete="off" disabled>
    <label class="btn btn-outline-primary btn-sm" for="btnradio1">Month</label>
  </div>
  </div>




<div style="width:100%;max-width:600px; height: 300px; border: 1px solid red; display: flex; flex-flow: row nowrap; justify-content: space-around; align-items: center">
  <img
    id=""
    src="{% static 'img/graph-preloader.gif' %}"
    class="center"
    height="150px"
    alt="spinner-gif">

</div>
<canvas id="gradeChart" style="width:100%;max-width:600px"></canvas>
</div>
</div>
<script id="json-chart-data" type="application/json">
  {
    "get_bets_url": "{% url 'get_bets' %}"
  }
</script>
<script>
  colors = ["#00876c",
  "#42986f",
  "#68a973",
  "#8cb978",
  "#b0c880",
  "#d3d78c",
  "#f7e59b",
  "#f4cc80",
  "#f1b26b",
  "#ed975c",
  "#e77b53",
  "#df5e50",
  "#d43d51",]
  const text_content = document.getElementById("json-chart-data").textContent
  const json_data = JSON.parse(text_content)
  const venue_select = document.getElementsByClassName("venue-select")

  button_checks = document.getElementsByClassName("btn-check")

  function build_graded_graph(graded_bets) {
    const grades = Object.keys(graded_bets)
    for (let i=0; i< grades.length; i++) {
      console.log(graded_bets[grades[i]])
    }
  }

  function handle_venue_select(e) {
    const target = e.currentTarget
    const venue_code = target.getAttribute("data-value");
    document.getElementById("btnGroupDrop1").textContent = target.textContent;

    $.ajax({
      url: json_data["get_bets_url"],
      dataType: "json",
      data: {"venue_code": venue_code},
      success: function(data) {
        build_graded_graph(data["graded_bets"])

      }
    })

  }

  function handle_time_select(e) {
    console.log("triggered")
    console.log(e)


    $.ajax({
      url: json_data["get_bets_url"],
      dataType: "json",
      data: {"date": "2022-05-15"},
      success: function(data) {
        console.log("YEAH")

      }
    })

  }

  for (let i=0; i<button_checks.length; i++) {
    button_checks[i].addEventListener("click", handle_time_select)
  }
  for (let i=0; i<venue_select.length; i++) {
    venue_select[i].addEventListener("click", handle_venue_select)
  }


var xValues = ["AA", "A", "B", "C"];
var yValues = [55, -49, 44, 24, 15];

const venues = ["Southland", "Tri-State", "Wheeling Downs"]

var barColors = ["#d62828", "#f77f00", "#fcbf49", "#eae2b7", "#003049"]
// new Chart("venueChart", {
//   type: "bar",
//   data: {
//     labels: venues,
//     datasets: [{
//       backgroundColor: barColors,
//       data: yValues
//     }]
//   },
//   options: {
//     legend: {display: false},
//     title: {
//       display: false,
//       text: "Venue Results"
//     }
//   }
// });

new Chart("gradeChart", {
  type: "bar",
  data: {
    labels: xValues,
    datasets: [{
      backgroundColor: barColors,
      data: yValues
    }]
  },
  options: {
    legend: {display: false},
    title: {
      display: true,
      text: "World Wine Production 2018"
    }
  }
});
</script>

{% endblock content %}
