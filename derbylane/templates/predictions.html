{% extends '_table.html'%}
{% load static %}

{% block extra_buttons %}
  <button type="button" class="btn btn-outline-primary btn-md">Large button</button>

{% endblock extra_buttons %}


{% block extra %}
{% include 'betmodal.html' %}
yea

<!-- <script id="json-chart-data" type="application/json">
  {
    "bets_url": "{% url 'load_bets' %}",
    "results_url": "{% url 'results' %}"
  }
</script> -->
<!-- <script src="{% static 'js/frontpage.js' %}"/> -->

<script>
  console.log("predictions.html")
  const modal = document.getElementById("bet-modal")



  modal.addEventListener("focus", function (e) {
    var button = $(event.relatedTarget) // Button that triggered the modal
    console.log(event)
    var participant_bets = document.getElementById("participant_bets")
    var dog = button.data('dog')
    var bets = button.data('bets')
    var post = button.data('post')
    console.log(button)
    var venue = button.data('venue')
    var chart = button.data('chart')
    var number = button.data('number')
    var participant = button.data('participant')
    console.log("participant.html")
    console.log(button.participant)
    var modal = $(this)
    modal.find('.modal-subtitle').text(
      post + " | " +
      dog + " "
    )
    modal.find('.modal-title').text(
      venue + " " +
      chart + " Race " +
      number
    )
    modal.find('#participant_uuid').text(
      participant
    )
    $('select option[value=' + bets).prop('selected',true);
  })

  window.onload = (event) => {
    const text_content = document.getElementById("json-chart-data").textContent
    const chart_json_data = JSON.parse(text_content)
    const chart_select = document.getElementById("chart-select")


    make_bet = () => {
      console.log("make bet")
      // text_content = document.getElementById("json-data").textContent
      participant_id = document.getElementById("participant_uuid").textContent
      console.log(participant_id)
      json_data = JSON.parse(text_content)
      console.log(json_data)
      console.log(document.getElementById("amount_input").value)
        $.ajax({
          url: json_data["make_bets_url"],
          dataType: "json",
          data: {
            "amount": document.getElementById("amount_input").value,
            "participant_id": participant_id,
            "bet_types": document.getElementById("bet_types").value
          },
          success: function(data) {
            console.log("success")
            button = document.createElement("button")
            span = document.createElement("span")
            span.setAttribute("style", "font-weight:bold")
            button.appendChild(span)
            button.disabled = !data["enabled"]
            if (data["bets"]) {
              button.setAttribute("class", "btn btn-sm btn-outline-success float-right")
              span.textContent= data["bets"]
            } else {
              button.setAttribute("class", "btn btn-sm btn-outline-light float-right")
              span.textContent= data["none"]
            }

          $("#" + participant_id + "-bet").html(button);
          }
        })
      }


    load_bets = () => {
      console.log("load bets")
      if (chart_select) {
        chart_id = chart_select.value
        $.ajax({
          url: chart_json_data["bets_url"],
          dataType: "html",
          data: {
            "chart_id": chart_id,
          },
          success: function(data) {
            $("#bets").html(data)
          }
        })
      }
    }

    load_bets()

  };

</script>

{% endblock extra %}
